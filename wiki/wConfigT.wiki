#summary Setting Up Configurations
#labels Deprecated
#sidebar wSb

<wiki:toc max_depth="2" />

<font color="red">Stop!</font> If you have a [wCusDeployed "Deployed" version] of Tunnelblick, it comes already set up -- you do no need to do anything more! Just [wUsing  start using it] and enjoy!

<font color="red">Stop!</font> If you have purchased VPN service from a VPN service provider, they should provide you with configuration files and instructions on how to use them with Tunnelblick.

<font color="red">Stop!</font> If you have VPN service from a corporate or other network provided by your employer, your network manager should provide you with configuration files and instructions on how to use them with Tunnelblick.

The rest of this document is for everyone else, or if you aren't getting support from the source you should.

==Setting Up Tunnelblick==
Installing Tunnelblick is not sufficient to connect to a VPN: you also need to tell Tunnelblick *_how_* to connect to the VPN.

You tell Tunnelblick how to connect to a VPN with a configuration file. Tunnelblick can use either of two types of configuration files:
  * Tunnelblick VPN Configurations, which are a Mac "package" (a folder that is usually treated as a single file), and which contains all of the configuration information, keys, certificates, and scripts that are needed to connect to a VPN.
  * OpenVPN configuration files, which are plain text files with extensions of .ovpn or .conf. These files may contain only the configuration information, or they may include within them the keys and certificates required to connect to a VPN. Often, though, the keys and certificates are held in separate files.

*We strongly suggest that you use a Tunnelblick VPN Configuration* because you can do more with it. For example, you can share it with all users of your computer, and you can set it up to start when your computer starts -- even before you log in. So these instructions tell you how to make one out of its components.

It's easy to make a Tunnelblick VPN Configuration: create a folder, put all the files related to the connection into the folder, give the folder the name that you want to know the configuration by, and add an extension of ".tblk" at the end of the folder name. Congratulations! You've just made a Tunnelblick VPN Configuration! Double-click on the folder and Tunnelblick will install the configuration. If its name conflicts with an existing installed configuration, you will be given the opportunity to change the name.

There's only one catch that sometimes trips people up: the OpenVPN configuration file (.ovpn or .conf file) must 


 uses a program called OpenVPN to do the actual VPN connection, so the primary 

When no configurations have been installed (which is usually the case the first time Tunnelblick is run by each user when using a non-deployed version of Tunnelblick), the following window will appear:

http://tunnelblick.googlecode.com/files/using-tunnelblick-welcome-2010-02-06.png

If you click "Install and edit sample configuration file”, Tunnelblick will create a sample [wPkgs Tunnelblick VPN Configurations] and open the OpenVPN configuration file within it in TextEdit for you to modify.

If you click "Quit”, Tunnelblick will quit without doing anything.

If you click "Open configuration folder", Tunnelblick will open a Finder window with `~/Library/Application Support/Tunnelblick/Configurations`, and then quit. Move or copy your OpenVPN configuration file(s) -- files with extensions of ".oven" or ".conf" -- to this window. If you have received key files or certificate files with your configuration file, move or copy them to this window also.

To launch Tunnelblick after setting up configuration and other files, double-click "Launch Tunnelblick" in the `Configurations` folder, or double-click Tunnelblick in the Applications folder.

==The "Set Nameserver" Check Box and DNS & WINS Settings==
If you are using DHCP, wish to use DNS and WINS servers at the far end of the tunnel when connected, and the VPN server you are connecting to "pushes" DNS and WINS settings to your client, put a check in the "Set nameserver" checkbox. (This is the situation for most users.)

If you are using DHCP, wish to use your original DNS and WINS servers when connected, and the VPN server you are connecting to does not "push" DNS or WINS settings to your client, un-check the "Set nameserver" checkbox.

If you are using manual settings, different versions of OS X behave differently. This is due to a change in network behavior in Snow Leopard and is beyond the scope of this project to fix.

If you're using Leopard (10.5) or Tiger (10.4), then it is possible to use the VPN-server-supplied DNS and WINS settings *in addition to* your manual settings by checking the "Set nameserver" box. However, your manual settings will always take precedence over any VPN server-supplied settings.  If "Set nameserver" is un-checked, you will continue to use only your manually-configured settings and any VPN server-supplied settings will be ignored.

If you are using Snow Leopard (10.6), then your manually-configured DNS and WINS settings will *always* be used, and no aggregation of configurations will be performed.

 * If you set your DNS servers manually, then regardless of the state of the "Set nameserver" box, your manual DNS servers will always be the only ones used.

 * If you set your Search Domain(s) manually, then regardless of the state of the "Set nameserver" box, your manual Search Domains will always be the only ones used.

 * If you set your WINS servers manually, then regardless of the state of the "Set nameserver" box, your manual WINS servers will always be the only ones used.

 * Each of these settings is independent of the others: if "Set nameserver" is checked, those settings not configured manually will be replaced by the settings obtained from the VPN server.  If "Set nameserver" is not checked, then as with Leopard/Tiger, no DNS/WINS settings will be applied.

*If your situation is not described above* (e.g., if you use manual DNS settings and wish to use DNS servers at the far end of a tunnel when connected, or you wish to use the OS X ability to use different nameservers for different domains), you must create your own up/down scripts and un-check the "Set nameserver" checkbox.

==Using openvpn-down-root.so==
When using "Set nameserver", it is usually necessary to avoid using the OpenVPN "user" and "group" options. These options cause OpenVPN to drop root privileges and take the privileges of the specified user and group. If this is done, then the standard scripts that handle restarting connections when there is a transient failure fail, because they are run without root privileges. And restoring routes when a tunnel is disconnected fails, too. So the "user" and "group" OpenVPN options should not be specified.

However, starting with Tunnelblick version 3.0b22, Tunnelblick includes the "openvpn-down-root.so" plugin for OpenVPN. It is located in theTunnelblick.app/Contents/Resources" folder. This plugin, when activated by including a line in the configuration file, allows the use of the "user" and "group" options, so that OpenVPN drops root privileges, but still has the scripts run as root, so reconnecting after transient network problems, or restoring routes when a tunnel is disconnected continue to work.

To activate the plugin:
  # Set the per-configuration boolean preference "CONFIG_NAME-useDownRootPlugin" to true.  If your configuration file is named "xyz.conf", the preference key is "xyz-useDownRootPlugin". (To set up the preference, use "Property List Editor.app" to  edit ~/Library/Preferences/com.openvpn.tunnelblick.plist and add the key, then right-click it and change the type to "boolean" and check it. “Property List Editor.app” is a small part of the free [http://developer.apple.com/technology/Xcode.html Developer Tools] available from Apple (a free Apple Developer Connection membership is required). The Developer Tools are a very large (over 900MB download) suite of programs for developing software for Macs.)
  # Include the following line in your configuration file:
{{{
    plugin path-to-openvpn-down-root.so     path-to-client.down.osx.sh
}}}
Example: If Tunnelblick.app is located in /Applications, the line would be:
{{{
    plugin /Applications/Tunnelblick.app/Contents/Resources/openvpn-down-root.so    /Applications/Tunnelblick.app/Contents/Resources/client.down.osx.sh 
}}}
Example: If Tunnelblick.app is located in /Applications and you have "Set nameserver" checked but "Monitor connection" unchecked, the line would be:
{{{
    plugin /Applications/Tunnelblick.app/Contents/Resources/openvpn-down-root.so    /Applications/Tunnelblick.app/Contents/Resources/client.nomonitor.down.osx.sh 
}}}
Example: If using a "deployed" version of Tunnelblick:
{{{
    plugin ../openvpn-down-root.so    ../client.down.osx.sh
}}}

------------------

===PLEASE USE THE [http://groups.google.com/group/tunnelblick-discuss TUNNELBLICK DISCUSSION GROUP] FOR COMMENTS OR QUESTIONS===